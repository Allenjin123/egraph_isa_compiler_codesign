# Gate-level synthesis script
# Converts ABC-optimized AIGER to gate-level netlist using Skywater SKY130 (sky130_fd_sc_hd, tt corner)

# Read the optimized AIGER design from external ABC
# This already has sequential optimization (scorr) applied
read_aiger /home/allenjin/Codes/egraph_isa_compiler_codesign/PdatScorrWrapper/ScorrPdat/output/dijkstra_small_O3_variant_gp/ibex_optimized_post_abc.aig

# Flatten design for technology mapping
flatten

# Technology mapping to PDK standard cells
dfflibmap -liberty /opt/pdk/skywater-pdk/libraries/sky130_fd_sc_hd/latest/timing/sky130_fd_sc_hd__tt_025C_1v80.lib

abc -liberty /opt/pdk/skywater-pdk/libraries/sky130_fd_sc_hd/latest/timing/sky130_fd_sc_hd__tt_025C_1v80.lib -fast

# Cleanup
opt_clean

# Write gate-level Verilog netlist
write_verilog -noattr -noexpr -nohex /home/allenjin/Codes/egraph_isa_compiler_codesign/PdatScorrWrapper/ScorrPdat/output/dijkstra_small_O3_variant_gp/ibex_optimized_gates.v

# Print statistics
stat -liberty /opt/pdk/skywater-pdk/libraries/sky130_fd_sc_hd/latest/timing/sky130_fd_sc_hd__tt_025C_1v80.lib
